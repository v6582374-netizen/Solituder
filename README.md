# Solituder (iOS Jarvis Agent MVP)

Solituder is an iOS-first, voice-native AI agent architecture designed for App Store distribution constraints.

## Implemented MVP foundations

- Foreground wake-word arming with explicit background suspension behavior.
- Pluggable provider interfaces for LLM and speech synthesis.
- OpenAI realtime adapter with HTTP fallback text path.
- ElevenLabs speech output adapter (BYOK).
- Local encrypted memory store (AES-GCM + Keychain key).
- Security policy engine for key-format validation, log redaction, and runtime risk checks.
- Lifecycle controller that enforces background suspension within 2 seconds.
- iOS SwiftUI app shell (`Apps/SolituderApp`) with:
  - Permission onboarding (microphone, speech recognition, notifications)
  - Key management with biometric reveal
  - Foreground standby and conversation test controls
- Orchestrator state machine:
  - `ArmedForeground`
  - `Conversing`
  - `BackgroundSuspended`

## Package targets

- `SolituderKit`: production code.
- `SolituderKitTests`: unit tests for state machine, wake-word behavior, memory, and security.

## Toolchain (project-scoped)

This repo uses project-scoped Xcode toolchain selection. No global `xcode-select` change is required.

```bash
source scripts/dev-env.sh
make verify-toolchain
make test
make spm-list-tests
```

Equivalent one-off command style:

```bash
DEVELOPER_DIR=/Applications/Xcode.app/Contents/Developer swift test
```

## Install On Your iPhone

Use the built-in scripts to build, install, and launch the app on a physical iPhone.

```bash
make iphone-list-devices
make iphone-install TEAM_ID=YOUR_TEAM_ID DEVICE_UDID=YOUR_DEVICE_UDID BUNDLE_ID=com.solituder.app.dev
```

Detailed checklist: [Docs/iPhoneTrial.md](Docs/iPhoneTrial.md)

## Quick usage example

```swift
import SolituderKit

let credentialStore = KeychainCredentialStore()
try await credentialStore.setKey("sk-your-openai-key", for: .openAI)
try await credentialStore.setKey("your-elevenlabs-key", for: .elevenLabs)

let orchestrator = SolituderAgentFactory.makeLiveAgent(credentialStore: credentialStore)

try await orchestrator.arm(modelId: "jarvis-cn")

// If wake-word auto-start is enabled and detected, state transitions to conversing.

let lifecycle = AgentLifecycleController(orchestrator: orchestrator)
await lifecycle.handleScenePhaseChange(.background) // suspends listening in <= 2s
```

## Security defaults

- BYOK credentials are stored in Keychain (`WhenUnlockedThisDeviceOnly`).
- Memory is encrypted locally; raw conversation audio is not persisted by default.
- Runtime risk checks can degrade capabilities when tampering is detected.

## Residency policy

- App Store path does **not** guarantee persistent background listening.
- Solituder commits to foreground standby.
- When the app enters background, listening is suspended within 2 seconds.

See [Docs/ResidencyPolicy.md](Docs/ResidencyPolicy.md).

## Notes

- `SolituderKit` provides core runtime primitives.
- `Apps/SolituderApp` is a runnable iOS shell generated by XcodeGen.
- To generate/open the app project:

```bash
cd Apps/SolituderApp
xcodegen generate
open SolituderApp.xcodeproj
```
